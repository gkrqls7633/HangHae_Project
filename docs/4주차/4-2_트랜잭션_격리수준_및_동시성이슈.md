# 1. νΈλμ­μ… κ²©λ¦¬ μμ¤€ λ° λ™μ‹μ„± μ΄μ

##  π“ νΈλμ­μ… κ²©λ¦¬ μμ¤€

### νΈλμ­μ… κ²©λ¦¬ μμ¤€μ΄λ€?
- νΈλμ­μ…μ΄ λ™μ‹μ— μ‹¤ν–‰λ  λ• λ°μ΄ν„° μΌκ΄€μ„±μ„ μ–Όλ§λ‚ λ³΄μ¥ν• μ§€ κ²°μ •ν•λ” μμ¤€.
- κ²©λ¦¬ μμ¤€μ΄ λ†’μ„μλ΅ μΌκ΄€μ„±μ€ μΆ‹μ•„μ§€μ§€λ§ μ„±λ¥μ€ λ–¨μ–΄μ§. λ°λ€λ΅ λ‚®μ„μλ΅ μ„±λ¥μ€ μΆ‹μ§€λ§ λ™μ‹μ„± λ¬Έμ κ°€ μƒκΈΈ μ  μμ.

### π“ νΈλμ­μ… κ²©λ¦¬ μμ¤€ μ •λ¦¬ν‘

| κ²©λ¦¬ μμ¤€           | Dirty Read | Non-Repeatable Read | Phantom Read | μ„±λ¥     | κΈ°λ³Έκ°’ (MySQL) |
|--------------------|------------|----------------------|---------------|----------|----------------|
| Read Uncommitted   | β… λ°μƒ     | β… λ°μƒ               | β… λ°μƒ        | π”¥ λΉ λ¦„  | β              |
| Read Committed     | β μ°¨λ‹¨     | β… λ°μƒ               | β… λ°μƒ        | π€ μΆ‹μ  | β              |
| Repeatable Read    | β μ°¨λ‹¨     | β μ°¨λ‹¨               | β… λ°μƒ        | π™‚ λ³΄ν†µ  | β… κΈ°λ³Έκ°’       |
| Serializable       | β μ°¨λ‹¨     | β μ°¨λ‹¨               | β μ°¨λ‹¨        | πΆ λλ¦Ό  | β              |

---
### κ° κ²©λ¦¬ μμ¤€ μ‹¤ν— λ‚΄μ©
- Read Uncommitted : Drity Read μ‹¤ν—
  - νΈλμ­μ… Aκ°€ μ»¤λ°‹ μ• ν• λ°μ΄ν„°λ¥Ό νΈλμ­μ… Bκ°€ μ½λ”μ§€ ν™•μΈ
- Read Committed
  - νΈλμ­μ… Aμ—μ„ λ‘ λ² μ½μ„ λ•, μ¤‘κ°„μ— Bκ°€ μμ •ν• κ°’μ΄ λ³΄μ΄λ”μ§€ ν™•μΈ
- Repeatable Read
  - νΈλμ­μ… Aμ—μ„ μ΅°κ±΄μ— λ§λ” rowλ¥Ό μ΅°νν• λ’¤, νΈλμ­μ… Bκ°€ row μ‚½μ… μ‹ Aμ— μν–¥μ„ λ―ΈμΉλ”μ§€ ν™•μΈ
- Serializable
  - λ¨λ“  λ™μ‹μ„± μ΄μκ°€ λ§‰νλ”μ§€ ν™•μΈ(Lock ν™•μΈ ν¬ν•¨)

### κ° κ²©λ¦¬ μμ¤€μ—μ„ λ°μƒν•  μ μλ” λ™μ‹μ„± μ΄μ μ •λ¦¬
- Dirty Read  
  μ»¤λ°‹λμ§€ μ•μ€ λ°μ΄ν„°λ¥Ό λ‹¤λ¥Έ νΈλμ­μ…μ΄ μ½λ” ν„μƒ

- Non-Repeatable Read
  κ°™μ€ λ°μ΄ν„°λ¥Ό λ‘ λ² μ½μ„ λ•, μ¤‘κ°„μ— κ°’μ΄ λ³€κ²½λμ–΄ λ‹¤λ¥Έ κ²°κ³Όκ°€ λ‚μ¤λ” ν„μƒ

- Phantom Read  
  μ΅°κ±΄μ— λ§λ” λ°μ΄ν„°λ¥Ό μ΅°νν–μ„ λ•, μ¤‘κ°„μ— μƒλ΅μ΄ λ°μ΄ν„°κ°€ μ¶”κ°€λμ–΄ κ²°κ³Όκ°€ λ‹¬λΌμ§€λ” ν„μƒ


### π“ μ°Έκ³ 
- MySQL(InnoDB)μ κΈ°λ³Έ κ²©λ¦¬ μμ¤€μ€ `Repeatable Read`
- μ„±λ¥κ³Ό μ •ν•©μ„±μ€ νΈλ μ΄λ“μ¤ν”„ κ΄€κ³„μ΄λ―€λ΅ μƒν™©μ— λ§λ” μ„ νƒμ΄ μ¤‘μ”

---

## **Read Uncommitted : Drity Read ν…μ¤νΈ**

## **λ©ν‘**
- **Dirty Read**λ¥Ό ν…μ¤νΈν•κΈ° μ„ν•΄ **Read Uncommitted** κ²©λ¦¬ μμ¤€μ„ μ‚¬μ©ν•μ—¬ νΈλμ­μ… κ°„μ λ™μ‹μ„± λ¬Έμ λ¥Ό ν™•μΈν•λ‹¤.
- ν…μ¤νΈλ” λ‘ κ°μ νΈλμ­μ…(A, B)μ„ λ™μ‹μ— μ‹¤ν–‰ν•μ—¬, νΈλμ­μ… Aκ°€ μ»¤λ°‹λμ§€ μ•μ€ μƒνƒμ—μ„ νΈλμ­μ… Bκ°€ λ°μ΄ν„°λ¥Ό μ½μ„ μ μλ”μ§€ κ²€μ¦ν•λ‹¤.

## **ν…μ¤νΈ μ‹λ‚λ¦¬μ¤**

1. **νΈλμ­μ… A**λ” μ‚¬μ©μμ ν¬μΈνΈλ¥Ό μμ •ν•κ³ , λ³€κ²½λ κ°’μ€ μ»¤λ°‹λμ§€ μ•μ€ μƒνƒμ—μ„ 2μ΄ λ™μ• λ€κΈ°ν•λ‹¤.
2. **νΈλμ­μ… B**λ” νΈλμ­μ… Aκ°€ μ‹μ‘λ ν›„, Aκ°€ μ»¤λ°‹λκΈ° μ „μ— ν•΄λ‹Ή ν¬μΈνΈλ¥Ό μ½κ³  λ³€κ²½λ κ°’μ„ ν™•μΈν•λ‹¤.
3. νΈλμ­μ… Aκ°€ μ»¤λ°‹λκΈ° μ „μ— νΈλμ­μ… Bλ” μ½μ„ μ μλ”μ§€ ν™•μΈν•μ—¬ **Dirty Read**κ°€ λ°μƒν–λ”μ§€ ν™•μΈν•λ‹¤.

## **ν…μ¤νΈ νλ¦„**
### 1. **Test Setup**
- **ν…μ¤νΈμ© λ°μ΄ν„° μ¤€λΉ„**:
  - ν…μ¤νΈμ© μ‚¬μ©μ(`User`)μ™€ κ·Έμ— μ—°κ΄€λ ν¬μΈνΈ(`Point`)λ¥Ό λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥ν•λ‹¤.
  - νΈλμ­μ… Aμ—μ„ μ‚¬μ©ν•λ” μ‚¬μ©μ ID(`savedUserId`)λ¥Ό μ €μ¥ν•λ‹¤.

### 2. **νΈλμ­μ… A: ν¬μΈνΈ μμ •**
- νΈλμ­μ… Aλ” **Read Uncommitted** κ²©λ¦¬ μμ¤€μ—μ„ μ‹¤ν–‰λλ‹¤.
- νΈλμ­μ… Aλ” ν¬μΈνΈλ¥Ό 100 μ¦κ°€μ‹ν‚¨ ν›„, μ»¤λ°‹λμ§€ μ•μ€ μƒνƒλ΅ 2μ΄ λ™μ• λ€κΈ°ν•λ‹¤.
- νΈλμ­μ… Aκ°€ μ»¤λ°‹λκΈ° μ „, νΈλμ­μ… Bκ°€ ν•΄λ‹Ή ν¬μΈνΈλ¥Ό μ½μ„ μ μλ”μ§€ ν™•μΈν•λ‹¤.

```java
@Transactional(isolation = Isolation.READ_UNCOMMITTED)
public void transactionA(Long userId) throws InterruptedException {
    Point point = pointRepository.findById(userId)
            .orElseThrow(() -> new RuntimeException("ν¬μΈνΈ μ •λ³΄κ°€ μ—†μµλ‹λ‹¤."));
    
    point.setPointBalance(point.getPointBalance() + 10000);  // ν¬μΈνΈ μ¦κ°€
    pointRepository.save(point);  // μ»¤λ°‹λμ§€ μ•μ€ μƒνƒλ΅ μμ •

    System.out.println("π“ νΈλμ­μ… A: ν¬μΈνΈ μμ • μ™„λ£ (μ»¤λ°‹ μ „)");
    
    // 2μ΄ λ€κΈ° ν›„ μ»¤λ°‹
    Thread.sleep(2000);  

    System.out.println("β… νΈλμ­μ… A μΆ…λ£ (μ»¤λ°‹)");
}

@Transactional(isolation = Isolation.READ_UNCOMMITTED)
public void transactionB(Long userId) {
    Point point = pointRepository.findById(userId)
            .orElseThrow(() -> new RuntimeException("ν¬μΈνΈ μ •λ³΄κ°€ μ—†μµλ‹λ‹¤."));
    
    System.out.println("π‘€ νΈλμ­μ… Bκ°€ μ½μ€ ν¬μΈνΈ μ”μ•΅: " + point.getPointBalance());
}
``` 

``` 
<μµμΆ… λ΅κ·Έ κ²°κ³Ό>
π“ νΈλμ­μ… A: ν¬μΈνΈ μμ • μ™„λ£ (μ»¤λ°‹ μ „)
π‘€ νΈλμ­μ… Bκ°€ μ½μ€ ν¬μΈνΈ μ”μ•΅: 200,000  -> Dirty Read λ°μƒ!!  (μλ„λ” 205,000μΈλ° MySQL( InnoDB)λ” READ UNCOMMITTED μ§€μ •ν•΄λ„ λ‚΄λ¶€μ μΌλ΅λ” Dirty Readλ¥Ό κ±°μ ν—μ©ν•μ§€ μ•μ.)

β… νΈλμ­μ… A μΆ…λ£ (μ»¤λ°‹)
``` 

---

## **Read Committed**
## **λ©ν‘**
- **Dirty Read**κ°€ λ°μƒν•μ§€ μ•μμ„ ν™•μΈν•κΈ° μ„ν•΄ **Read Committed** κ²©λ¦¬ μμ¤€μ„ μ‚¬μ©ν•λ” νΈλμ­μ… κ°„ λ™μ‹μ„± ν…μ¤νΈλ¥Ό μν–‰ν•λ‹¤.
- νΈλμ­μ… Aκ°€ μ»¤λ°‹λμ§€ μ•μ€ μƒνƒμ—μ„ νΈλμ­μ… Bκ°€ λ™μΌ λ°μ΄ν„°λ¥Ό μ½μ„ μ μλ”μ§€λ¥Ό ν™•μΈν•μ—¬ **Dirty Read λ°©μ§€ μ—¬λ¶€**λ¥Ό κ²€μ¦ν•λ‹¤.

## **ν…μ¤νΈ μ‹λ‚λ¦¬μ¤**

1. **νΈλμ­μ… A**λ” μ‚¬μ©μ ν¬μΈνΈλ¥Ό μμ •ν• ν›„, **μ»¤λ°‹ν•μ§€ μ•κ³  2μ΄κ°„ λ€κΈ°**ν•λ‹¤.
2. **νΈλμ­μ… B**λ” νΈλμ­μ… Aκ°€ **μ»¤λ°‹λκΈ° μ „**, λ™μΌ ν¬μΈνΈ λ°μ΄ν„°λ¥Ό μ΅°νν•λ‹¤.
3. νΈλμ­μ… Bκ°€ **λ³€κ²½λ λ°μ΄ν„°λ¥Ό μ½μ§€ λ»ν•κ³ **, κΈ°μ΅΄ λ°μ΄ν„°λ¥Ό μ΅°νν•΄μ•Ό ν…μ¤νΈ μ„±κ³µμΌλ΅ κ°„μ£Όν•λ‹¤.

## **ν…μ¤νΈ νλ¦„**
### 1. **Test Setup**
- **ν…μ¤νΈμ© λ°μ΄ν„° μ¤€λΉ„**:
  - ν…μ¤νΈμ© Userμ™€ Pointλ¥Ό μƒμ„±ν•λ‹¤.
  - ν…μ¤νΈ λ©”μ„λ“ μ‹μ‘ μ „ DBμ— λ°μ΄ν„° μ €μ¥ λ° μ»¤λ°‹ μ™„λ£

### 2. **νΈλμ­μ… A: ν¬μΈνΈ μμ •**
- κ²©λ¦¬ μμ¤€: `READ_COMMITTED`
- λ™μ‘ λ‚΄μ©:
  - ν¬μΈνΈ `+5000` μ¦κ°€ (`205000`)
  - DBμ— μ»¤λ°‹μ€ ν•μ§€ μ•μ
  - 2μ΄κ°„ λ€κΈ°ν•μ—¬ νΈλμ­μ… Bκ°€ μ΅°νν•  μ μλ„λ΅ μ λ„

```java
@Transactional(isolation = Isolation.READ_COMMITTED)
public void readCommittedTransactionA(Long userId) throws InterruptedException {
  // ν¬μΈνΈ μ΅°ν
  Point point = pointRepository.findById(userId)
          .orElseThrow(() -> new RuntimeException("ν¬μΈνΈ μ •λ³΄κ°€ μ—†μµλ‹λ‹¤."));

  point.setPointBalance(point.getPointBalance() + 5000L);  // ν¬μΈνΈ μ¦κ°€
  pointRepository.save(point);  // μ»¤λ°‹λμ§€ μ•μ€ μƒνƒλ΅ μμ •

  System.out.println("###### νΈλμ­μ… A: ν¬μΈνΈ μμ • μ™„λ£ (μ»¤λ°‹ μ „)");
  // 2μ΄ λ€κΈ° ν›„ μ»¤λ°‹
  Thread.sleep(2000); // Bκ°€ μ΄ μ‚¬μ΄μ— μ½λ„λ΅ μ λ„
  System.out.println("###### νΈλμ­μ… A μΆ…λ£ (μ»¤λ°‹)");
}

@Transactional(isolation = Isolation.READ_COMMITTED)
public void readCommittedTransactionB(Long userId) {
  // νΈλμ­μ… Aμ—μ„ μ»¤λ°‹λ λ°μ΄ν„°λ¥Ό μ½μ„ μ μλ”μ§€ ν™•μΈ
  Point point = pointRepository.findById(userId)
          .orElseThrow(() -> new RuntimeException("ν¬μΈνΈ μ •λ³΄κ°€ μ—†μµλ‹λ‹¤."));

  System.out.println("###### νΈλμ­μ… Bκ°€ μ½μ€ ν¬μΈνΈ μ”μ•΅: " + point.getPointBalance());
}
``` 

``` 
<μµμΆ… λ΅κ·Έ κ²°κ³Ό>
π“ νΈλμ­μ… A: ν¬μΈνΈ μμ • μ™„λ£ (μ»¤λ°‹ μ „)
π‘€ νΈλμ­μ… Bκ°€ μ½μ€ ν¬μΈνΈ μ”μ•΅: 200,000 -> AνΈλμ­μ…μ΄ μ»¤λ°‹λκΈ° μ „ λ°μ΄ν„°λ¥Ό μ΅°νν•¨.
β… νΈλμ­μ… A μΆ…λ£ (μ»¤λ°‹)
``` 

---

## **Repeatable Read**
## **λ©ν‘**
- λ™μΌ νΈλμ­μ… λ‚΄μ—μ„ λ™μΌν• λ°μ΄ν„°λ¥Ό μ—¬λ¬ λ² μ΅°νν•  λ• **μΌκ΄€λ κ²°κ³Όκ°€ λ°ν™λλ”μ§€ κ²€μ¦**ν•λ‹¤.
- νΈλμ­μ… Aκ°€ ν¬μΈνΈ λ°μ΄ν„°λ¥Ό λ‘ λ² μ΅°νν•κ³ , κ·Έ μ‚¬μ΄ νΈλμ­μ… Bκ°€ κ°’μ„ μμ •ν•λ” μ‹λ‚λ¦¬μ¤λ¥Ό ν†µν•΄ **Repeatable Read** κ²©λ¦¬ μμ¤€μ νΉμ„±μ„ ν…μ¤νΈν•λ‹¤.

## **ν…μ¤νΈ μ‹λ‚λ¦¬μ¤**

1. **νΈλμ­μ… A**λ” ν¬μΈνΈλ¥Ό ν• λ² μ΅°νν• λ’¤, **2μ΄κ°„ λ€κΈ°** ν›„ λ‹¤μ‹ κ°™μ€ λ°μ΄ν„°λ¥Ό μ΅°νν•λ‹¤.
2. **νΈλμ­μ… B**λ” Aμ μ²« μ΅°ν μ΄ν›„ λ°μ΄ν„°λ¥Ό **μμ •ν•κ³  μ»¤λ°‹**ν•λ‹¤.
3. Aμ λ‘ λ²μ§Έ μ΅°ν μ‹ κ°’μ΄ **μ²μκ³Ό λ™μΌν•λ©΄ Repeatable Read λ³΄μ¥**, **λ‹¬λΌμ΅λ‹¤λ©΄ κΉ¨μ§**.

## **ν…μ¤νΈ νλ¦„**
### 1. **Test Setup**

- **μ΄κΈ° λ°μ΄ν„°**
  - ν¬μΈνΈ μ”μ•΅: `200000`
  - μ‚¬μ©μ ID: `savedUserId`μ— μ €μ¥
  - νΈλμ­μ… Aμ™€ Bλ” ν•΄λ‹Ή μ‚¬μ©μ IDλ΅ μ΅°ν λ° μμ •

### 2. **νΈλμ­μ… A: λ‘ λ² μ΅°ν**

- κ²©λ¦¬ μμ¤€: `REPEATABLE_READ`
- μν–‰ λ‚΄μ©:
  1. ν¬μΈνΈ **μ²« μ΅°ν**
  2. νΈλμ­μ… B μ‹¤ν–‰μ„ μ λ„ (`CountDownLatch`)
  3. 2μ΄ ν›„ **λ‘ λ²μ§Έ μ΅°ν**
  4. λ‘ μ΅°ν κ²°κ³Ό λΉ„κµ

```java
@Transactional(isolation = Isolation.REPEATABLE_READ)
public void repeatableReadTransactionA(Long userId, CountDownLatch latch) throws InterruptedException {
  Point point1 = pointRepository.findById(userId)
          .orElseThrow(() -> new RuntimeException("ν¬μΈνΈ μ •λ³΄κ°€ μ—†μµλ‹λ‹¤."));

  System.out.println("π” [A] μ²« μ΅°ν: " + point1.getPointBalance());
  latch.countDown(); // B μ‹¤ν–‰ μ‹μ‘ μ•λ¦Ό

  Thread.sleep(2000); // Bκ°€ μ¤‘κ°„μ— μμ •ν•λ„λ΅ λ€κΈ°

  Point point2 = pointRepository.findById(userId)
          .orElseThrow(() -> new RuntimeException("ν¬μΈνΈ μ •λ³΄κ°€ μ—†μµλ‹λ‹¤."));
  System.out.println("π” [A] λ‘ λ²μ§Έ μ΅°ν: " + point2.getPointBalance());

  if (point1.getPointBalance().equals(point2.getPointBalance())) {
    System.out.println("β… Repeatable Read λ³΄μ¥λ¨: λ‘ μ΅°ν κ²°κ³Ό λ™μΌ");
  } else {
    System.out.println("β Repeatable Read κΉ¨μ§: κ°’μ΄ λ‹¬λΌμ§");
  }
}

@Transactional
public void repeatableReadTransactionB(Long userId) {
  Point point = pointRepository.findById(userId)
          .orElseThrow(() -> new RuntimeException("ν¬μΈνΈ μ •λ³΄κ°€ μ—†μµλ‹λ‹¤."));

  point.setPointBalance(point.getPointBalance() + 10000);
  pointRepository.save(point);
  pointRepository.flush();
  System.out.println("βοΈ [B] ν¬μΈνΈ μμ • λ° μ»¤λ°‹ μ™„λ£");
}
``` 

``` 
<μµμΆ… λ΅κ·Έ κ²°κ³Ό>
[A] μ²« μ΅°ν: 200000
[B] ν¬μΈνΈ μμ • λ° μ»¤λ°‹ μ™„λ£
[A] λ‘ λ²μ§Έ μ΅°ν: 200000
Repeatable Read λ³΄μ¥λ¨: λ‘ μ΅°ν κ²°κ³Ό λ™μΌ
``` 

---

## **Serializable**


---



