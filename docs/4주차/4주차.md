# 1. 트랜잭션의 개념 & ACID 원칙

##  📌 트랜잭션의 개념
- DB의 상태를 변경시키기 위해 수행하는 작업 단위
- 즉, DBa에서 트랜잭션은 하나의 거래를 안전하게 처리하도록 보장해주는 것
- DB가 제공하는 트랜잭션 기능을 사용하면 commit과 rollback으로 정상적인 작업이 가능하도록 할 수 있다

## 트랜잭션의 특징 (ACID)

### 원자성(Atomicity)

- 트랜잭션 내에서 실행한 작업들은 마치 하나의 작업인 것처럼 모두 성공 하거나 모두 실패해야 한다. 즉, 일부만 성공하는 상태는 존재해서는 안된다.
- 예시 : 계좌 이체의 경우 송금/입금 두 작업이 반드시 모두 성공하거나 모두 실패해야 하고, 중간에 실패하면 전체 거래가 취소되어야 한다.
- MySQL의 InnoDB의 경우 MVCC)(Multi-version Concurrency Control)를 통해 원자성을 보장한다.
  - MVCC(다중 버전 동시성 제어)는 레코드 레벨의 잠금을 지원하고 UNDO 로그로 하나의 레코드에 대한 여러 버전을 동시에 관리할 수 있는 기술이다.
  - Lock 없이 일관된 읽기를 보장하고 변경 관리와 롤백도 지원한다.
  - UNDO 로그 : 데이터 변경 전의 이전 값을 보관. 롤백 시 언두 로그를 참조하여 이전 상태로 보관.

### 일관성(Consistency)

- 트랜잭션이 완료된 후에는 DB가 항상 일관된 상태를 유지해야 한다.
- 예시 : "계좌 잔액이 마이너스가 되면 안된다" 같은 제약조건들이 항상 지켜져야 한다.
- MySQL의 InnoDB의 경우 외래키(참조 무결성 체크), 유니크 인덱스(중복 데이터 방지) 등의 제약조건으로 일관성을 보장한다.

### 격리성(Isolation)

- 동시에 실행되는 트랜잭션드이 서로에게 영향을 미치지 않도록 격리해야한다. 즉, 실행 중인 트랜잭션이 다른 트랜잭션에 영향을 받아선 안된다.
- 예시 : 동시에 여러 거래가 발생할 때도 각 거래는 서로 영향을 주지 않아야 한다.
- MySQL의 InnoDB의 경우 트랜잭션 격리 수준으로 격리성을 보장한다.
  - 격리성은 동시성과 관련된 성능 이슈로 인해 트랜잭션 격리 수준(Isolation lebvel)을 선택할 수 있다.
- 트랜잭션 격리 수준
  - READ UNCOMMITED(커밋되지 않은 읽기)
  - READ COMMITTED(커밋된 읽기)
  - REPEATABLE READ(반복 가능한 읽기)
  - SERIALIZABLE(직렬화 가능)

### 지속성(Durability)
- 트랜잭션을 성공적으로 끝내면 그 결과가 항상 기록되어야 한다. 즉, 트랜잭션이 커밋되면 결과는 DB에 영구적으로 저장되어 보존되어야 한다.
- 예시 : 거래가 완료됐다면 거래가 성공/실패 했더라도 거래 내역은 영구적으로 보존되어야 한다.
- MySQL의 InnoDBd의 경우 REDO 로그로 지속성을 보장한다.
  - REDO 로그는 트랜잭션의 영구 보존을 위한 로그이다.
  - 데이터 변경이 일어나는 모든 것을 기록하고 장애 발생 시 REDO 로그로 데이터 복구를 보장한다.

## 📌 Spring에서의 트랜잭션 AOP
- 스프링은 트랜잭션 AOP를 처리하기 위한 모든 기능을 제공한다.
- 스프링 부트를 사용하면 트랜잭션 AOP를 처리하기 위해 필요한 스프링 빈을 자동으로 등록해주고, 우리는 트랜잭션 처리가 필요한 곳에 @Transactional 어노테이션만 사용하면 된다.
- 스프링의 트랜잭션 AOP는 이 @Transactional 어노테이션을 인식해서 트랜잭션 처리하는 프록시를 적용해준다.


## 📌 커밋 / 롤백의 의미
### 커밋

- 커밋은 트랜잭션의 작업을 최종적으로 DB에 반영하는 과정을 의미한다.
- 트랜잭션에 포함된 논리 작업 단위를 성공적으로 수행되었고, 데이터가 무결성을 준수한다면 커밋을 통해 DB에 반영한다.
- 커밋을 수행하면 하나의 트랜잭션 과정을 종료하는 것이다.

### 롤백

- 작업 중 문제가 발생되어 트랜잭션의 처리과정에서 발생한 변경사항을 취소하는 것이다.
- 트랜잭션이 시작되기 이전의 상태로 되돌린다.
- 즉 마지막 커밋을 완료한 시점으로 다시 돌아간다.

## 📌 트랜잭션이 필요한 이유
데이터의 일관성, 무결성, 안정성을 보장하기 위함이다.
여러 작업이 하나의 단위로 처리되어야 할 때, 중간에 오류가 발생하면 전체 작업을 원래 상태로 되돌릴 수 있어야 한다.
이를 통해 시스템은 예기치 않은 오류나 장애 상황에서도 신뢰할 수 있는 결과를 유지할 수 있다.


