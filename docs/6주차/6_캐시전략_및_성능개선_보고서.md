# ν•­ν•΄ 6μ£Όμ°¨ κ³Όμ 

## λ©μ°¨
[1. λ°°κ²½](#1-λ°°κ²½)  
[2. λ¬Έμ  ν•΄κ²°](#2-λ¬Έμ -ν•΄κ²°)  
[3. ν…μ¤νΈ](#3-ν…μ¤νΈ)  
[4. ν•κ³„μ ](#4-ν•κ³„μ )  
[5. κ²°λ΅ ](#5-κ²°λ΅ )


# βοΈ 1. λ°°κ²½

μ½μ„νΈ μλ§¤ μ‹μ¤ν…μ—μ„ λ‹¤μ λ‘ κΈ°λ¥μ μ„±λ¥ ν–¥μƒμ„ μ„ν•΄ μΊμ‹± μ „λµμ„ μ‚¬μ©ν•λ‹¤.

- **ν¬μΈνΈ μ΅°ν / μ¶©μ „** κΈ°λ¥μ€ μ‚¬μ©μκ°€ μ¦μ€ μ΅°νλ¥Ό ν•μ§€λ§ λ³€κ²½μ€ λ“λ¬ΌκΈ° λ•λ¬Έμ— μΊμ‹λ¥Ό ν†µν•΄ μ‘λ‹µ μ†λ„λ¥Ό κ°μ„ ν•  μ μλ‹¤.
- **μ½μ„νΈ λ©λ΅ μ΅°ν**λ” λΉ„κµμ  μμ£Ό λ°”λ€μ§€ μ•λ” λ°μ΄ν„°μ΄λ©°, μ μ € μ ‘μ† μ‹ μμ£Ό νΈμ¶λκΈ° λ•λ¬Έμ— μΊμ‹± μ ν•©μ„±μ΄ λ†’λ‹¤.

μ΄λ¥Ό ν†µν•΄ λ¶ν•„μ”ν• DB μ΅°νλ¥Ό μ¤„μ΄κ³  μ‹μ¤ν… μ‘λ‹µ μ†λ„λ¥Ό λ†’μ΄κ³ μ ν•μ€λ‹¤.

## π“Β  1.1 μΊμ‹ μ „λµ λΉ„κµ

Memory Cache vs Redis Cache

| ν•­λ© | **Memory Cache** | **Redis Cache** |
| --- | --- | --- |
| **μ„μΉ** | μ• ν”λ¦¬μΌ€μ΄μ… λ‚΄λ¶€ JVM λ©”λ¨λ¦¬ | μ™Έλ¶€ Redis μ„λ²„ (λ…λ¦½ ν”„λ΅μ„Έμ¤) |
| **μ†λ„** | λ§¤μ° λΉ λ¦„ (JVM λ‚΄ μ ‘κ·Ό) | λΉ λ¦„ (λ„¤νΈμ›ν¬ IO ν¬ν•¨) |
| **ν™•μ¥μ„±** | λ‹¨μΌ μΈμ¤ν„΄μ¤ ν•μ • | μ—¬λ¬ μ„λ²„μ—μ„ κ³µμ  κ°€λ¥ (λ¶„μ‚° μΊμ‹) |
| **λ°μ΄ν„° κ³µμ ** | λ¶κ°€ (μ„λ²„ κ°„ μΊμ‹ κ³µμ  μ• λ¨) | κ°€λ¥ (μ—¬λ¬ μΈμ¤ν„΄μ¤ κ°„ μΊμ‹ κ³µμ ) |
| **μμ†μ„±** | μ„λ²„ μ¬μ‹μ‘ μ‹ μΊμ‹ μ‚¬λΌμ§ | Redisλ” μ„¤μ •μ— λ”°λΌ μ§€μ† κ°€λ¥ (RDB, AOF λ“±) |
| **μ‚¬μ© μ** | κ°„λ‹¨ν• μΊμ‹, λ΅μ»¬ κ³„μ‚° κ²°κ³Ό μ €μ¥ λ“± | μ„Έμ… κ΄€λ¦¬, μΈμ¦ ν† ν°, λ¶„μ‚° λ½, μ΅°ν μΊμ‹ λ“± |
| **TTL μ„¤μ •** | μλ™μΌλ΅ μ½”λ“μ— μ§μ ‘ κµ¬ν„ | TTL μ§€μ›, λ§λ£ μ „λµ λ‹¤μ–‘ν•¨ |
| **λ°μ΄ν„° μ©λ‰ μ ν•** | JVM λ©”λ¨λ¦¬ μμ΅΄ (OutOfMemory μ„ν— μ΅΄μ¬) | μ„λ²„ λ¦¬μ†μ¤μ— λ”°λΌ μ μ—°ν•κ² κ΄€λ¦¬ κ°€λ¥ |
| **μ¥μ•  ν—μ©μ„±** | μ„λ²„ μ£½μΌλ©΄ μΊμ‹λ„ μ†λ©Έ | Redis ν΄λ¬μ¤ν„°λ΅ μ¥μ•  λ€μ‘ κ°€λ¥ |

## π“Β 1.2 μΊμ‹± μ „λµ μ„ νƒ : **Redis Cache**

- **λ¶„μ‚° ν™κ²½**μ—μ„ μ—¬λ¬ μΈμ¤ν„΄μ¤κ°€ λ™μΌν• μΊμ‹ λ°μ΄ν„°λ¥Ό κ³µμ ν•΄μ•Ό ν•¨

  β†’ Redisλ” μ„λ²„ κ°„ **κ³µμ  μΊμ‹**κ°€ κ°€λ¥ν•μ—¬ μν‰ ν™•μ¥μ΄ μ©μ΄ν•¨.

- **λ¶„μ‚° λ½ μ²λ¦¬** ν•„μ” (μ: ν¬μΈνΈ μ¶©μ „ λ™μ‹μ„± μ μ–΄)

  β†’ Redissonμ„ ν™μ©ν• **λ¶„μ‚° λ½**μ€ Redis κΈ°λ°μ—μ„λ§ κ°€λ¥.

- **TTL, ν‚¤ λ§λ£ μ „λµ** λ“± μ μ—°ν• μΊμ‹ κ΄€λ¦¬ κΈ°λ¥ ν•„μ”

  β†’ Redisλ” **μΊμ‹ λ§λ£, TTL μ„¤μ •**μ„ μ§€μ›ν•¨.

- **μ¬μ‹μ‘ ν›„ μΊμ‹ λ³µκµ¬ μµμ…**μ΄ ν•„μ”ν•¨

  β†’ Redisλ” μ„¤μ •μ— λ”°λΌ μΊμ‹ λ°μ΄ν„°λ¥Ό λ””μ¤ν¬μ— μ €μ¥ κ°€λ¥ν•¨.


---

# βοΈ 2. λ¬Έμ  ν•΄κ²°

## π“Β 2.1. μ μ© μ „λµ

### ν¬μΈνΈ μ΅°ν / μ¶©μ „

| κµ¬λ¶„ | μ „λµ | μ„¤λ… |
| --- | --- | --- |
| ν¬μΈνΈ μ΅°ν | LookAside | `@Cacheable`μ„ μ‚¬μ©ν•μ—¬ μΊμ‹ μ΅΄μ¬ μ‹ Redisμ—μ„ λ°”λ΅ μ‘λ‹µ, μ—†μΌλ©΄ DB μ΅°ν ν›„ μΊμ‹ μ €μ¥ |
| ν¬μΈνΈ μ¶©μ „ | WriteThrough | μ¶©μ „ μ‹ DB μ—…λ°μ΄νΈμ™€ ν•¨κ» `@CacheEvict`λ΅ μΊμ‹ λ§λ£ μ²λ¦¬ |

### μ½μ„νΈ λ©λ΅ μ΅°ν

| κµ¬λ¶„ | μ „λµ | μ„¤λ… |
| --- | --- | --- |
| μ½μ„νΈ λ©λ΅ μ΅°ν | LookAside | μ΅°ν μ‹ μΊμ‹μ— μ΅΄μ¬ν•λ©΄ λ°”λ΅ λ°ν™ν•κ³ , μ—†μΌλ©΄ DB μ΅°ν ν›„ μΊμ‹± |

## π“Β 2.2. μΊμ‹ μ„¤μ •

- μΊμ‹ TTLμ€ `CacheTtlRegistry` ν΄λμ¤λ¥Ό ν†µν•΄ λ¶„λ¦¬ν•κ³ , `enum`μΌλ΅ κ΄€λ¦¬ν•μ—¬ ν™•μ¥μ„±κ³Ό κ°€λ…μ„± ν™•λ³΄.
- `GenericJackson2JsonRedisSerializer`λ¥Ό μ‚¬μ©ν•΄ JSON μ§λ ¬ν™”λ΅ Redisμ— μ €μ¥.

```java
@Configuration
@EnableCaching
public class RedisCacheConfig {

    private final CacheTtlRegistry cacheTtlRegistry;

    public RedisCacheConfig(CacheTtlRegistry cacheTtlRegistry) {
        this.cacheTtlRegistry = cacheTtlRegistry;
    }

    @Bean
    public RedisCacheManager redisCacheManager(RedisConnectionFactory connectionFactory) {

        RedisSerializationContext.SerializationPair<String> stringSerializer = RedisSerializationContext.SerializationPair.fromSerializer(new StringRedisSerializer());
        RedisSerializationContext.SerializationPair<Object> jsonSerializer = RedisSerializationContext.SerializationPair.fromSerializer(new GenericJackson2JsonRedisSerializer());

        Map<String, RedisCacheConfiguration> cacheConfigs = new HashMap<>();
        for (CacheName cacheName : CacheName.values()) {
            cacheConfigs.put(
                    cacheName.getName(),
                    RedisCacheConfiguration.defaultCacheConfig()
                            .entryTtl(cacheTtlRegistry.getTtlFor(cacheName.getName()))
                            .serializeKeysWith(stringSerializer)
                            .serializeValuesWith(jsonSerializer)
            );
        }

        RedisCacheConfiguration defaultConfig = RedisCacheConfiguration.defaultCacheConfig()
                .entryTtl(Duration.ofMinutes(10))
                .serializeKeysWith(stringSerializer)
                .serializeValuesWith(jsonSerializer);

        return RedisCacheManager
                .builder(connectionFactory)
                .cacheDefaults(defaultConfig)
                .withInitialCacheConfigurations(cacheConfigs)
                .build();
    }
}

@Component
public class CacheTtlRegistry {

    public Duration getTtlFor(String cacheName) {

        for (CacheName cache : CacheName.values()) {
            if (cache.getName().equals(cacheName)) {
                return cache.getTtl();
            }
        }
        return Duration.ofMinutes(10); // default TTL 10λ¶„
    }
}

public enum CacheName {

    CONCERT_CACHE("concertCache", Duration.ofMinutes(60)),
    USER_POINT("userPoint", Duration.ofMinutes(10));

    private final String name;
    private final Duration ttl;

    CacheName(String name, Duration ttl) {
        this.name = name;
        this.ttl = ttl;
    }

    public String getName() {
        return name;
    }

    public Duration getTtl() {
        return ttl;
    }
}
```

---

# βοΈΒ 3. ν…μ¤νΈ

## π“Β 3.1. μ½μ„νΈ

- **μ½μ„νΈ λ©λ΅ API**: μµμ΄ μ”μ²­ μ‹ DB μ ‘κ·Ό ν›„ Redisμ— μ €μ¥λ¨μ„ ν™•μΈ, μ΄ν›„ μ”μ²­μ€ Redisμ—μ„ μ΅°νλ¨.
  - μΊμ‹ μ΅°ν μ‹ 6395ms β†’ 9ms λ΅ μ„±λ¥ ν™•μ—°ν•κ² κ°μ„ 
  - [μ½μ„νΈ μ΅°ν](μ½μ„νΈ_μ΅°ν_μΊμ‹±.png)


## π“Β 3.2. ν¬μΈνΈ

- **ν¬μΈνΈ μ΅°ν API**: ν¬μΈνΈ μ¶©μ „ μ „κΉμ§€ Redisμ—μ„ μ΅°νλλ©°, μ¶©μ „ μ‹μ μ— μΊμ‹κ°€ λ…μ‹μ μΌλ΅ λ§λ£λ¨μ„ ν™•μΈ.
  - μΊμ‹ μ΅°ν μ‹ 175ms β†’ 11ms λ΅ μ„±λ¥ ν™•μ—°ν•κ² κ°μ„ 
  - [ν¬μΈνΈ_μ΅°ν](ν¬μΈνΈ_μ΅°ν_μΊμ‹±.png)


- **ν¬μΈνΈ μ¶©μ „ API** : ν¬μΈνΈ μ¶©μ „ μ‹ μΊμ‹ λ§λ£ μ²λ¦¬λ¨μ„ ν™•μΈ. (μ¬μ΅°ν μ‹ DBμ—μ„ μ΅°νλ¨)
  - [ν¬μΈνΈ_μ¶©μ „](ν¬μΈνΈ_μ¶©μ „_μΊμ‹±.png)

---

# βοΈΒ 4. ν•κ³„μ 

## π“Β 4.1. μ‹¤μ‹κ°„ λ°μ΄ν„°μ μΊμ‹± μ „λµ ν•κ³„

μΆμ„ μμ™€ κ°™μ€ μ‹¤μ‹κ°„ λ°μ΄ν„°λ” μ‚¬μ©μμ ν–‰λ™(μμ•½, μ·¨μ† λ“±)μ— λ”°λΌ **μκ°„μ μΌλ΅ λ³€λ™λλ” κ°’**μ΄λ©°, μ‹μ¤ν… λ‚΄μ—μ„ **κ°•ν• μΌκ΄€μ„±**μ΄ μ”κµ¬λλ” λ€ν‘μ μΈ μΌ€μ΄μ¤μ…λ‹λ‹¤. μ΄ λ°μ΄ν„°λ¥Ό Redis μΊμ‹μ— μ €μ¥ν•κ³  μΌμ • μ‹κ°„ λ™μ• μ μ§€ν•λ” λ°©μ‹μ€ λ‹¤μκ³Ό κ°™μ€ μ„ν—μ„ λ™λ°ν•©λ‹λ‹¤.

- **λ°μ΄ν„° λ¶μΌμΉ**: μΊμ‹μ— μ €μ¥λ μΆμ„ μ •λ³΄κ°€ μµμ‹  μƒνƒλ¥Ό λ°μν•μ§€ λ»ν•  μ μμΌλ©°, μ΄λ΅ μΈν•΄ μ΄λ―Έ μμ•½λ μΆμ„μ„ λ λ‹¤λ¥Έ μ‚¬μ©μμ—κ² λ³΄μ—¬μ£Όλ” λ“±μ λ¬Έμ κ°€ λ°μƒν•  μ μμµλ‹λ‹¤.
- **κ²½μ μ΅°κ±΄**: λ‹¤μμ μ‚¬μ©μκ°€ λ™μ‹μ— μμ•½μ„ μ‹λ„ν•  κ²½μ°, μΊμ‹κ°€ λ°μλμ§€ μ•μ•„ λ™μΌν• μΆμ„μ— μ¤‘λ³µ μμ•½ μ”μ²­μ΄ λ°μƒν•  μ μμµλ‹λ‹¤.
- **κ°±μ‹  λ¶€λ‹΄**: μ‹¤μ‹κ°„μΌλ΅ μΊμ‹λ¥Ό κ°±μ‹ ν•λ” μ‘μ—…μ€ μ¤νλ ¤ Redisμ— κ³Όλ„ν• λ¶€ν•λ¥Ό μ λ°ν•κ³ , DBλ³΄λ‹¤ μ•μ •μ μ΄μ§€ μ•μ€ μƒνƒλ΅ λ°μ΄ν„°λ¥Ό μ κ³µν•κ² λ  κ°€λ¥μ„±μ΄ μμµλ‹λ‹¤.
- **νΈλμ­μ… μΌκ΄€μ„± λ¶€μ΅±**: DB νΈλμ­μ… λ‚΄μ—μ„μ μΆμ„ μ²λ¦¬ λ΅μ§κ³Ό Redis μΊμ‹ κ°±μ‹  λ΅μ§μ„ μ™„μ „ν λ™κΈ°ν™”ν•κΈ° μ–΄λ µκΈ° λ•λ¬Έμ—, **ACID** μ›μΉ™μ„ κΉ¨λ¨λ¦΄ μ„ν—μ΄ μμµλ‹λ‹¤.

μ‹¤μ‹κ°„μ„±μ΄ μ”κµ¬λλ” λ°μ΄ν„°(μμ•½ κ°€λ¥ μΆμ„ μ λ“±)λ” μΊμ‹κ°€ μ•„λ‹ **DB μ§μ ‘ μ΅°νμ™€ νΈλμ­μ… μ μ–΄**λ¥Ό ν†µν•΄ μΌκ΄€μ„±μ„ μ μ§€ν•λ” λ°©μ‹μ΄ μ μ ν•©λ‹λ‹¤. μΊμ‹λ” **λ³€κ²½ λΉλ„κ°€ λ‚®κ³  μ΅°ν λΉλ„κ°€ λ†’μ€ λ°μ΄ν„°**μ— κµ­ν•ν•μ—¬ μ μ©ν•λ” κ²ƒμ΄ μ‹μ¤ν…μ μ•μ •μ„±κ³Ό μ •ν™•μ„±μ„ λ³΄μ¥ν•λ” λ°©ν–¥μ…λ‹λ‹¤.

## π“Β 4.2. Cache Stampede λ¬Έμ 

- μΊμ‹ μ¤νƒ¬ν”Όλ“(Cache Stampede)λ” **κ°™μ€ ν‚¤μ— λ€ν• μΊμ‹κ°€ λ§λ£λμ—μ„ λ•**, λ‹¤μμ μ”μ²­μ΄ λ™μ‹μ— μΊμ‹κ°€ μ•„λ‹ **DB λλ” μ›λ³Έ λ°μ΄ν„° μ†μ¤**λ΅ μ λ¦¬λ” ν„μƒμ„ λ§ν•©λ‹λ‹¤.

μμ‹ μƒν™©)

1. `concert:list:all` λ°μ΄ν„°κ°€ Redisμ— TTL 10λ¶„μΌλ΅ μ €μ¥λ¨.
2. 10λ¶„ λ’¤ ν•΄λ‹Ή ν‚¤κ°€ λ§λ£λ¨.
3. λ™μ‹μ— μλ°±~μμ² κ°μ μ”μ²­μ΄ μ½μ„νΈ λ©λ΅μ„ μ”μ²­ν•¨.
4. μΊμ‹μ— μ•„λ¬΄κ²ƒλ„ μ—†μΌλ―€λ΅ λ¨λ“  μ”μ²­μ΄ DBλ΅ ν–¥ν•¨.
5. **DB κ³Όλ¶€ν•** λ°μƒ β†’ μ„±λ¥ μ €ν•, μ¥μ• λ΅ μ΄μ–΄μ§ μ μμ.

ν•΄κ²° λ°©λ²•)

| μ „λµ | μ„¤λ… |
| --- | --- |
| **Mutex(λ¶„μ‚° λ½)** | μ²« λ²μ§Έ μ”μ²­λ§ DBλ¥Ό μ΅°νν•κ³  λ‚λ¨Έμ§€λ” λ€κΈ°ν•κ±°λ‚ μΊμ‹ μ΅°ν μ¬μ‹λ„ (Redisson λ¶„μ‚°λ½ λ“± ν™μ©) |
| **Cache Prewarming(μ‚¬μ „ λ΅λ”©)** | μΊμ‹κ°€ λ§λ£λκΈ° μ „μ— λ°±κ·ΈλΌμ΄λ“ μ¤λ λ“κ°€ λ―Έλ¦¬ μΊμ‹λ¥Ό κ°±μ‹  |
| **TTL+Jitter** | TTLμ— μ†λ‰μ λλ¤κ°’μ„ λ”ν•΄ κ° ν‚¤μ λ§λ£ μ‹μ μ„ λ¶„μ‚° |
| **Request Coalescing** | λ™μΌν• ν‚¤ μ”μ²­μ„ ν•λ‚λ΅ ν•©μ³ μ²λ¦¬ν•κ³  κ²°κ³Όλ¥Ό λ¨λ“  μ”μ²­μμ—κ² μ „λ‹¬ (λ³µμ΅ν• κµ¬ν„ ν•„μ”) |

---

# βοΈΒ 5. κ²°λ΅ 

- Redis μΊμ‹ μ μ©μ„ ν†µν•΄ μ£Όμ” API μ‘λ‹µ μ†λ„ ν–¥μƒ λ° DB λ¶€ν• κ°μ† ν¨κ³Όλ¥Ό ν™•μΈν•¨.
- μΊμ‹ μ „λµ(LookAside, WriteThrough)μ„ κ° κΈ°λ¥ νΉμ„±μ— λ§κ² μ μ ν λ¶„λ¦¬ν•μ—¬ μ μ©ν•¨.
- TTL μ •μ±…μ€ Config ν΄λμ¤μ™€ Enum κΈ°λ°μ Registryλ΅ κ΄€λ¦¬ν•μ—¬ μ μ§€λ³΄μμ„±μ„ λ†’μΌ μ μμ.
- μ„λΉ„μ¤ κ³„μΈµμ— μΊμ‹ μ–΄λ…Έν…μ΄μ…μ„ μΌκ΄€λκ² μ μ©ν•μ—¬ μ±…μ„ λ¶„λ¦¬ μ›μΉ™ λ”°λ¦„.



[μΊμ‹ μ „λµ λ° μ„±λ¥ κ°μ„  λ³΄κ³ μ„ notion](https://www.notion.so/teamsparta/6-1e52dc3ef51480b2b1e2f5afd4f09bfb#1e52dc3ef5148052b204e7b56cecefef)
